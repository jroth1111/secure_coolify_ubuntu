1..237
ok 1 ensure_admin_access: creates user with sudo group when user doesn't exist
ok 2 ensure_admin_access: adds sudo group to existing user without it
ok 3 ensure_admin_access: creates sudoers.d file with NOPASSWD
ok 4 ensure_admin_access: creates .ssh directory with correct permissions
ok 5 ensure_admin_access: adds public key to authorized_keys
ok 6 validate_inputs: rejects root as admin user
ok 7 validate_inputs: rejects invalid username format
ok 8 validate_inputs: rejects empty admin user
ok 9 validate_pubkey: accepts valid ed25519 key
ok 10 validate_pubkey: accepts valid rsa key
ok 11 validate_pubkey: rejects invalid key format
ok 12 validate_pubkey: rejects empty key
ok 13 validate_pubkey: rejects key with only key type
ok 14 validate_inputs: accepts BIND_DASHBOARD_TO_TAILSCALE=true in dry-run
ok 15 validate_inputs: requires Coolify .env when BIND_DASHBOARD_TO_TAILSCALE=true (non-dry-run)
ok 16 get_tailscale_ip: returns cached IP
ok 17 configure_coolify_binding: skips when BIND_DASHBOARD_TO_TAILSCALE=false
ok 18 configure_coolify_binding: dry-run shows planned changes
ok 19 configure_coolify_binding: sets APP_PORT to Tailscale IP:8000
ok 20 configure_coolify_binding: sets SOKETI_PORT to Tailscale IP:6001
ok 21 configure_coolify_binding: fails when Tailscale IP not detected
ok 22 write_state: includes tailscale_ip when binding configured
ok 23 write_state: includes bind_dashboard_to_tailscale flag
ok 24 TAILSCALE_CIDR: defaults to 100.64.0.0/10
ok 25 validate_inputs: accepts all dashboard binding options together
ok 26 deploy: preflight phase marker exists
ok 27 deploy: phase1 upload+harden marker exists
ok 28 deploy: hardening invocation uses env-file and tailscale install
ok 29 deploy: gate A checks admin SSH on tailscale
ok 30 deploy: gate B verifies admin identity
ok 31 deploy: gate C runs validate_hardening.sh json
not ok 32 deploy: gate D validates service active and managed rules
# (in test file tests/unit/test_deploy_workflow_contract.bats, line 37)
#   `grep -Fq "Gate D failed: docker-user-hardening.service is not active." "${DEPLOY_SCRIPT}"' failed
ok 33 deploy: phase4 binding+dns marker exists
ok 34 deploy: gate E fails when exposure checks do not pass
ok 35 deploy: final validation is executed
ok 36 deploy: matrix includes all DEP contract ids
ok 37 docs consistency: workflow contract file exists
ok 38 docs consistency: contract contains bootstrap ids
ok 39 docs consistency: contract contains deploy and setup ids
ok 40 docs consistency: checker script exists
ok 41 docs consistency: checker script passes
ok 42 is_true: '1' returns 0
ok 43 is_true: 'true' returns 0
ok 44 is_true: 'yes' returns 0
ok 45 is_true: 'y' returns 0
ok 46 is_true: 'on' returns 0
ok 47 is_true: 'TRUE' (uppercase) returns 0
ok 48 is_true: 'false' returns 1
ok 49 is_true: '0' returns 1
ok 50 is_true: empty string returns 1
ok 51 is_true: 'no' returns 1
ok 52 require_value: non-empty value passes
ok 53 require_value: empty value dies with 'requires a value'
ok 54 usage: prints required and optional flag sections
ok 55 script_run: dry-run logs command and skips execution
ok 56 script_run: executes command when dry-run is disabled
ok 57 setup_logging: dry-run does not touch log file
ok 58 validate_pubkey: accepts ed25519 key
ok 59 validate_pubkey: accepts rsa key
ok 60 validate_pubkey: accepts ecdsa key
ok 61 validate_pubkey: accepts sk-ssh-ed25519 key
ok 62 validate_pubkey: rejects garbage
ok 63 validate_pubkey: rejects empty string
ok 64 validate_pubkey: rejects type-only (no key data)
ok 65 validate_inputs: valid inputs pass
ok 66 validate_inputs: missing ADMIN_USER fails
ok 67 validate_inputs: ADMIN_USER=root fails
ok 68 validate_inputs: invalid username fails
ok 69 validate_inputs: non-numeric SSH_PORT fails
ok 70 validate_inputs: SSH_PORT=0 fails
ok 71 validate_inputs: SSH_PORT=70000 fails
ok 72 validate_inputs: bad time format fails
ok 73 validate_inputs: bad retention format fails
ok 74 validate_inputs: ENABLE_AUTO_REBOOT=maybe fails
ok 75 validate_inputs: missing ADMIN_PUBKEY fails
ok 76 detect_wan_iface: keeps explicitly provided WAN_IFACE
ok 77 detect_wan_iface: fails when auto-detect returns no interface
ok 78 ensure_packages: skips apt-get when all packages are installed
ok 79 ensure_packages: installs only missing packages via apt-get
ok 80 require_commands: dry-run only requires base command set
ok 81 require_commands: fails when a required command is missing
ok 82 configure_unattended_upgrades: writes disabled reboot policy when requested
ok 83 parse_args: --admin-user sets ADMIN_USER
ok 84 parse_args: --tunnel-mode sets TUNNEL_MODE=true
mkdir: cannot create directory '/tmp/bats-run-y203gT/test/85': Read-only file system
Failed to create BATS_TEST_TMPDIR1: /tmp/bats-run-y203gT/test/85
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
/usr/local/libexec/bats-core/bats-exec-file: line 236: /usr/local/libexec/bats-core/bats-exec-test: Input/output error
write /dev/stderr: no space left on device
